<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc version="1.3" reference="FarmTools.XarImporter" locale="">
  <web>FarmTools</web>
  <name>XarImporter</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1566472957000</creationDate>
  <parent>FarmTools.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1566474262000</date>
  <contentUpdateDate>1566474262000</contentUpdateDate>
  <version>1.1</version>
  <title>XAR Importer</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{include document="FarmTools.FarmImporterDisplayMacros" /}}

{{velocity}}
#if ("$!request.action" == '')
{{info}}
This page allows to import a XAR into multiple subwikis at once. Launched jobs can then be monitored using the [[Active Jobs application&gt;&gt;https://extensions.xwiki.org/xwiki/bin/view/Extension/Active%20Jobs%20Application/]], to be installed beforehand in that case.
{{/info}}

{{html}}
  &lt;form action="" method="post"&gt;
   &lt;dl&gt;
     &lt;dt&gt;XAR location on the server filesystem&lt;/dt&gt;
     &lt;dd&gt;&lt;input type="text" name="xar" size="60" placeholder='file:/tmp/my-file.xar'/&gt;&lt;/dd&gt;
     &lt;dt&gt;Target wikis&lt;/dt&gt;
     &lt;dd&gt;#displayWikisListSelector()&lt;/dd&gt;
   &lt;/dl&gt;
   &lt;div&gt;
   &lt;button class="btn btn-default" name="action" value="import" type="submit"&gt;Import&lt;/button&gt;
   &lt;/div&gt;
  &lt;/form&gt;
{{/html}}

#elseif ("$!request.action" == 'import')
  |=Wiki|=Job
  #foreach ($wikiId in $!request.getParameterValues('wikis'))
    #set ($inputType = 'xwiki+xar/1.1')
    #set ($outputType = 'xwiki+instance+document')
    #set ($inputProperties = {'withExtension':true, 'forceDocument':false, 'withHistory':true, 'verbose': true, 'source': 'file:/tmp/xwiki-afcen-pdfviewer-4.0-SNAPSHOT.xar'})
    #set ($outputProperties = {'defaultReference':"wiki:$wikiId", 'previousDeleted':false, 'verbose':true, 'saveComment':'Import', 'versionPreserved':true, 'authorPreserved':true, 'stoppedWhenSaveFail':true})
    #set($job = $services.filter.startConvert($inputType, $inputProperties, $outputType, $outputProperties))
    |$wikiId|$job
    #set ($flag = true)
  #end
  #if ($flag &amp;&amp; $xwiki.exists('XWiki.ActiveJobs'))

  {{info}}
  The status of the launched jobs can be monitored from page [[XWiki.ActiveJobs]], from the group node titled "filter/converter".
  {{/info}}
  #end
#end

{{/velocity}}</content>
</xwikidoc>
